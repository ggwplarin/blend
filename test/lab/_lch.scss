@use '../../node_modules/sass-true/sass/true' as *;
@use '../../sass/lab/lch';
@use 'sass:meta';
@use 'sass:string';

@include describe('lab/lch') {
  @include describe('to-rgb()') {
    @include it('converts an array of lch values to sRGB') {
      @include assert-equal(
        lch.to-rgb([ 50, 50, 50 ]),
        [ 0.6998182949215365, 0.37306358392607797, 0.21448501707165485 ]
      );
    }
  }

  @include describe('in-gamut()') {
    @include it('Returns RGB values for in-gamut LCH colors') {
      @include assert-equal(
        lch.in-gamut(30, 50, 300),
        [0.3034570655, 0.2260585045, 0.5459735834],
        $inspect: true
      );
    }

    @include it('Returns null for out-of-gamut LCH colors') {
      @include assert-equal(
        lch.in-gamut(80, 80, 300),
        null
      );
    }
  }

  @include describe('gamut-correct()') {
    @include it('Returns LCH input & RGB results for in-gamut colors') {
      @include assert-equal(
        lch.gamut-correct(30, 50, 300),
        (
          'lch': (30, 50, 300),
          'rgb': [0.3034570655, 0.2260585045, 0.5459735834],
        ),
        $inspect: true
      );
    }

    @include it('Returns corrected LCH & RGB for iout-of-gamut colors') {
      @include assert-equal(
        lch.gamut-correct(80, 80, 300),
        (
          'lch': (80, 34.7755050659, 300),
          'rgb': [0.8223957484, 0.739750038, 1.0000045534],
        ),
        $inspect: true
      );
    }
  }

  @include describe('value()') {
    @include it('Converts in-gamut LCH/a input to (sRGB) Sass color') {
      @include assert-equal(
        meta.type-of(lch.value(30% 50 300)),
        'color'
      );

      @include assert-equal(
        lch.value(30% 50 300),
        #4d3a8b
      );
    }

    @include it('Converts out-of-gamut LCH/a input to (sRGB) Sass color') {
      @include assert-equal(
        lch.value(80% 80 300),
        #d2bdff
      );
    }

    @include it('Accepts an alpha channel') {
      @include assert-equal(
        lch.value(30% 50 300, 50%),
        rgba(77, 58, 139, 0.5)
      );
    }

    @include it('Optioally returns a string value') {
      @include assert-equal(
        lch.value(30% 50 300, $string: 'rgb'),
        string.unquote('rgb(30.35% 22.61% 54.6%)'),
        'without alpha channel'
      );

      @include assert-equal(
        lch.value(30% 50 300, 50%, $string: 'rgb'),
        string.unquote('rgb(30.35% 22.61% 54.6% / 50%)'),
        'with alpha channel'
      );
    }

    @include it('Optionally allows out-of-gamut colors to clip') {
      @include assert-equal(
        lch.value(80% 80 300, $gamut-correct: false),
        #d8aeff
      );
    }

    @include it('Optionally allows `null` return for out-of-gamut colors') {
      @include assert-equal(
        lch.value(80% 80 300, $gamut-correct: null),
        null
      );
    }
  }
}
